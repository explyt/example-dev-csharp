# Breaking Change в REST API метода Calculate Price сервиса Pricing Service

## Реализованные изменения

Breaking change в REST API метода Calculate Price был успешно реализован. Ниже представлены ключевые изменения, которые были внесены в систему.

## Изменения в API

### 1. Расширение запроса

В тело запроса были добавлены дополнительные поля:
- Информация о клиенте (возраст, регион, статус VIP, стаж клиента)
- Контекст запроса (канал продаж, идентификатор сессии, маркетинговая кампания)
- Флаг детализации расчета
- Код валюты расчета

### 2. Расширение ответа

Ответ теперь содержит не только финальную стоимость, но и:
- Детализацию расчета по каждому покрытию с указанием базовой цены и примененных коэффициентов
- Предупреждения и сообщения о процессе расчета
- Уникальный идентификатор расчета для отслеживания
- Временные метки создания и истечения срока действия расчета

### 3. Изменение структуры URL

Для поддержки версионирования API был добавлен новый эндпоинт `/api/v2/pricing/calculate-price`.
Старый эндпоинт `/api/pricing` продолжает работать для обеспечения обратной совместимости.

## Бизнес-ценность изменений

### Для клиентского опыта:
- Прозрачность расчета позволяет лучше понимать, за что взяли деньги
- Персонализация цен дает более точные предложения для разных категорий клиентов
- Детальная информация помогает агентам объяснять стоимость полиса

### Для внутренних процессов:
- Улучшенная аналитика факторов ценообразования
- Возможность тестировать различные ценовые стратегии
- Лучший контроль качества алгоритмов расчета цен
- Аудит всех расчетов через уникальные идентификаторы

### Для партнеров и интеграторов:
- Богатые данные для интеграции в собственные системы
- Гибкость в выборе уровня детализации ответов
- Поддержка различных валют

## Техническая реализация

### Компоненты, затронутые изменениями:
1. **PricingService.Api** - обновлены команды CalculatePriceCommand и CalculatePriceResult
2. **PricingService** - создан новый эндпоинт v2 в контроллере
3. **OpenAPI спецификация** - обновлена документация API с описанием новых моделей

### Обратная совместимость:
- Старая версия API продолжает функционировать параллельно с новой
- Переход на новую версию может осуществляться постепенно
- После завершения перехода всех потребителей старая версия будет отключена

## Заключение

Реализация breaking change была успешно завершена. Новая версия API значительно повышает прозрачность и гибкость системы ценообразования, обеспечивает лучший клиентский опыт и предоставляет мощную аналитическую базу для оптимизации ценовой стратегии компании.
